(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))t(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&t(r)}).observe(document,{childList:!0,subtree:!0});function s(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function t(o){if(o.ep)return;o.ep=!0;const a=s(o);fetch(o.href,a)}})();const x={newyear:{title:"Kuldvillak",emoji:"üéÜ",walkingElements:["üéá","ü•Ç"]},halloween:{title:"Kuldvillak",emoji:"üéÉ",walkingElements:["üêà","üêà"]}};let m="newyear";function y(){return m==="halloween"?["halloween1","halloween2"]:["newyear1"]}const u={};function O(){const e=localStorage.getItem("kuldvillak-theme");(e==="halloween"||e==="newyear")&&(m=e),C()}function C(){document.documentElement.setAttribute("data-theme",m);const e=x[m],n=document.querySelector(".landing-title");n&&(n.textContent=`${e.title} ${e.emoji}`);const s=document.getElementById("game-title");s&&(s.textContent=`${e.title} ${e.emoji}`),document.querySelectorAll(".cat").forEach((r,l)=>{r.textContent=e.walkingElements[l%e.walkingElements.length]});const o=document.getElementById("theme-toggle");o&&(o.textContent=m==="newyear"?"üéÉ Halloween":"üéÜ New Year");const a=document.getElementById("game2-card");a&&(a.style.display=m==="newyear"?"none":"flex")}function H(){m=m==="newyear"?"halloween":"newyear",localStorage.setItem("kuldvillak-theme",m),C()}async function G(e){try{const n=await fetch(`/${e}.json`);if(!n.ok)throw new Error(`Failed to load ${e}.json`);return u[e]=await n.json(),u[e]}catch(n){return console.error(`Error loading game data for ${e}:`,n),alert(`Failed to load game data: ${n instanceof Error?n.message:"Unknown error"}`),null}}let i={teams:[],answeredQuestions:[],currentQuestion:null,selectedGame:"newyear1",currentTurn:0,lastPicker:0},c={gameId:null,title:"",categories:["","","","",""],questions:[],isModified:!1},v=null;document.addEventListener("DOMContentLoaded",()=>{O(),W(),S(),I(),B(),document.getElementById("theme-toggle")?.addEventListener("click",H),document.getElementById("game1-card")?.addEventListener("click",()=>q(y()[0])),document.getElementById("game2-card")?.addEventListener("click",()=>q(y()[1])),document.getElementById("create-game-card")?.addEventListener("click",()=>P()),document.getElementById("team-count")?.addEventListener("change",S),document.getElementById("start-game-btn")?.addEventListener("click",D),document.getElementById("back-to-landing-btn")?.addEventListener("click",b),document.getElementById("show-answer-btn")?.addEventListener("click",$),document.getElementById("close-modal-btn")?.addEventListener("click",w),document.getElementById("reset-game-btn")?.addEventListener("click",_),document.getElementById("back-to-menu-btn")?.addEventListener("click",b),document.getElementById("game-title")?.addEventListener("click",b),document.getElementById("editor-back-btn")?.addEventListener("click",se),document.getElementById("import-btn")?.addEventListener("click",oe),document.getElementById("export-btn")?.addEventListener("click",ie),document.getElementById("save-game-btn")?.addEventListener("click",re),document.getElementById("import-file-input")?.addEventListener("change",ae),document.getElementById("cancel-question-edit-btn")?.addEventListener("click",N),document.getElementById("save-question-edit-btn")?.addEventListener("click",ne),document.addEventListener("keydown",e=>{document.getElementById("question-modal")?.classList.contains("active")&&(e.key==="Escape"&&w(),(e.key===" "||e.key==="Spacebar")&&(e.preventDefault(),$()))})});function g(e){document.querySelectorAll(".screen").forEach(n=>n.classList.remove("active")),document.getElementById(e)?.classList.add("active")}function q(e){i.selectedGame=e;const n=`kuldvillak-game-state-${e}`,s=localStorage.getItem(n);if(s)try{const t=JSON.parse(s);if(t.teams&&t.teams.length>0){const o={teams:t.teams,answeredQuestions:[],currentQuestion:t.currentQuestion||null,selectedGame:e,currentTurn:t.currentTurn??0,lastPicker:t.lastPicker??0};Array.isArray(t.answeredQuestions)&&t.answeredQuestions.length>0&&(typeof t.answeredQuestions[0]=="string"?o.answeredQuestions=t.answeredQuestions.map(a=>({questionId:a,answeredBy:null,isPositive:null})):o.answeredQuestions=t.answeredQuestions.map(a=>({questionId:a.questionId,answeredBy:a.answeredBy,isPositive:a.isPositive??(a.answeredBy!==null?!0:null)}))),i=o}else k()}catch(t){console.error(`Error loading saved game ${e}:`,t),k()}else k();S(),g("setup-screen")}function b(){i.teams.length>0&&p(),i={teams:[],answeredQuestions:[],currentQuestion:null,selectedGame:y()[0],currentTurn:0,lastPicker:0},g("landing-screen"),I()}function S(){const e=document.getElementById("team-count"),n=parseInt(e.value),s=document.getElementById("team-inputs");if(s){s.innerHTML="";for(let t=1;t<=n;t++){const o=document.createElement("input");o.type="text",o.className="setup-input",o.placeholder=`Tiim ${t} nimi`,o.id=`team-${t}`,o.value=i.teams[t-1]?.name||`Tiim ${t}`,s.appendChild(o)}}}async function D(){const e=document.getElementById("team-count"),n=parseInt(e.value);k();for(let t=1;t<=n;t++){const a=document.getElementById(`team-${t}`)?.value||`Tiim ${t}`;i.teams.push({name:a,score:0})}const s=i.selectedGame;!u[s]&&!await G(s)||(p(),E(),g("game-screen"))}function E(){j(),J()}function j(){const e=document.getElementById("scores-container");e&&(e.innerHTML="",i.teams.forEach((n,s)=>{const t=document.createElement("div");t.className="team-score",s===i.currentTurn&&t.classList.add("active-turn"),t.innerHTML=`
      <div class="team-name">${n.name}</div>
      <div class="team-points">${n.score}</div>
    `,e.appendChild(t)}))}function J(){const e=document.getElementById("jeopardy-board");if(!e)return;e.innerHTML="";const n=u[i.selectedGame];if(!n){console.error("Game data not loaded for:",i.selectedGame);return}n.categories.forEach(t=>{const o=document.createElement("div");o.className="category-cell",o.textContent=t,e.appendChild(o)}),[100,200,300,400,500].forEach(t=>{n.categories.forEach((o,a)=>{const r=n.questions.find(f=>f.category===a&&f.value===t),l=document.createElement("div");l.className="question-cell";const d=`${a}-${t}`;i.answeredQuestions.find(f=>f.questionId===d)&&l.classList.add("answered"),l.textContent=t.toString(),r&&(l.onclick=f=>V(r,d,f.currentTarget)),e.appendChild(l)})})}function V(e,n,s){i.currentQuestion={...e,id:n};const t=document.getElementById("modal-value"),o=document.getElementById("modal-question"),a=document.getElementById("modal-answer"),r=document.getElementById("show-answer-btn");t&&(t.textContent=e.value.toString()),o&&(o.textContent=e.question),a&&(a.textContent=`${e.answer}`,a.classList.remove("visible")),r&&(r.style.display="block"),K();const l=document.getElementById("question-modal"),d=document.querySelector(".modal-content");"startViewTransition"in document&&s?(console.log("Using View Transition API"),document.documentElement.classList.add("is-transitioning"),s.classList.add("transitioning"),document.startViewTransition(()=>{s.classList.remove("transitioning"),l?.classList.add("active"),d?.classList.add("transitioning")}).finished.finally(()=>{document.documentElement.classList.remove("is-transitioning")})):(console.log("View Transition API not supported, using CSS transitions"),l?.classList.add("active"))}function $(){const e=document.getElementById("modal-answer"),n=document.getElementById("show-answer-btn");e?.classList.add("visible"),n&&(n.style.display="none")}function K(){const e=document.getElementById("team-buttons");if(!e)return;e.innerHTML="";const n=i.currentQuestion;if(!n)return;const s=i.answeredQuestions.find(o=>o.questionId===n.id);if(s){const o=document.createElement("div");if(o.className="previous-answer-indicator",s.answeredBy===null)o.textContent="Eelnevalt: Vastuseta";else{const a=i.teams[s.answeredBy]?.name||"Teadmata",r=s.isPositive?"‚úì":"‚úó";o.textContent=`Eelnevalt: ${r} ${a}`}e.appendChild(o)}i.teams.forEach((o,a)=>{const r=document.createElement("div");r.className="team-button-group";const l=document.createElement("button");l.className="btn-team btn-team-positive",l.textContent=`‚úì ${o.name}`,s&&s.answeredBy===a&&s.isPositive===!0&&l.classList.add("previously-selected"),l.onclick=()=>F(a),r.appendChild(l);const d=document.createElement("button");d.className="btn-team btn-team-negative",d.textContent=`‚úó ${o.name}`,s&&s.answeredBy===a&&s.isPositive===!1&&d.classList.add("previously-selected"),d.onclick=()=>U(a),r.appendChild(d),e.appendChild(r)});const t=document.createElement("button");t.className="btn-team btn-skip",t.textContent="Vastuseta",s&&s.answeredBy===null&&t.classList.add("previously-selected"),t.onclick=()=>R(),e.appendChild(t)}function F(e){const n=i.currentQuestion;if(!n)return;const s=i.answeredQuestions.findIndex(t=>t.questionId===n.id);if(s!==-1){const t=i.answeredQuestions[s];t.answeredBy!==null&&(t.isPositive?i.teams[t.answeredBy].score-=n.value:i.teams[t.answeredBy].score+=n.value),i.teams[e].score+=n.value,i.answeredQuestions[s]={questionId:n.id,answeredBy:e,isPositive:!0},i.currentTurn=e,i.lastPicker=e}else i.teams[e].score+=n.value,i.answeredQuestions.push({questionId:n.id,answeredBy:e,isPositive:!0}),i.currentTurn=e,i.lastPicker=e;p(),w(),E(),i.answeredQuestions.length===u[i.selectedGame].questions.length&&setTimeout(()=>Q(),500)}function U(e){const n=i.currentQuestion;if(!n)return;const s=i.answeredQuestions.findIndex(t=>t.questionId===n.id);if(s!==-1){const t=i.answeredQuestions[s];t.answeredBy!==null&&(t.isPositive?i.teams[t.answeredBy].score-=n.value:i.teams[t.answeredBy].score+=n.value),i.teams[e].score-=n.value,i.answeredQuestions[s]={questionId:n.id,answeredBy:e,isPositive:!1},i.currentTurn=i.lastPicker}else i.teams[e].score-=n.value,i.answeredQuestions.push({questionId:n.id,answeredBy:e,isPositive:!1}),i.currentTurn=i.lastPicker;p(),w(),E(),i.answeredQuestions.length===u[i.selectedGame].questions.length&&setTimeout(()=>Q(),500)}function R(){const e=i.currentQuestion;if(!e)return;const n=i.answeredQuestions.findIndex(s=>s.questionId===e.id);if(n!==-1){const s=i.answeredQuestions[n];s.answeredBy!==null&&(s.isPositive?i.teams[s.answeredBy].score-=e.value:i.teams[s.answeredBy].score+=e.value),i.answeredQuestions[n]={questionId:e.id,answeredBy:null,isPositive:null}}else i.answeredQuestions.push({questionId:e.id,answeredBy:null,isPositive:null});p(),w(),E(),i.answeredQuestions.length===u[i.selectedGame].questions.length&&setTimeout(()=>Q(),500)}function w(){const e=document.getElementById("question-modal"),n=document.querySelector(".modal-content");"startViewTransition"in document&&n?.classList.contains("transitioning")?(console.log("Closing with View Transition API"),document.documentElement.classList.add("is-transitioning"),document.startViewTransition(()=>{e?.classList.remove("active"),n?.classList.remove("transitioning")}).finished.finally(()=>{document.documentElement.classList.remove("is-transitioning")})):(console.log("Closing with CSS transitions"),e?.classList.remove("active"),n?.classList.remove("transitioning")),i.currentQuestion=null}function Q(){const e=document.getElementById("podium");if(!e)return;e.innerHTML="";const n=[...i.teams].sort((a,r)=>r.score-a.score),s=["first","second","third"],t=["ü•á","ü•à","ü•â"];n.slice(0,3).forEach((a,r)=>{const l=document.createElement("div");l.className=`podium-place ${s[r]}`,l.style.animationDelay=`${r*.3}s`,l.innerHTML=`
      <div class="place-number">${t[r]}</div>
      <div class="place-team">${a.name}</div>
      <div class="place-score">${a.score} punkti</div>
    `,e.appendChild(l)}),g("end-screen"),z();const o=`kuldvillak-game-state-${i.selectedGame}`;localStorage.removeItem(o)}function z(){const n={newyear:["#4a90d9","#ffd700","#c0c0c0","#1a237e","#2dd881"],halloween:["#ff6b35","#f7b32b","#2dd881","#6b2d5c"]}[m];for(let s=0;s<50;s++)setTimeout(()=>{const t=document.createElement("div");t.className="confetti",t.style.left=Math.random()*100+"%",t.style.background=n[Math.floor(Math.random()*n.length)],t.style.animationDuration=Math.random()*2+2+"s",t.style.animationDelay=Math.random()+"s",document.body.appendChild(t),setTimeout(()=>t.remove(),5e3)},s*50)}function _(){i={teams:[],answeredQuestions:[],currentQuestion:null,selectedGame:y()[0],currentTurn:0,lastPicker:0},p()}function p(){const e=`kuldvillak-game-state-${i.selectedGame}`;localStorage.setItem(e,JSON.stringify(i))}function k(){const e=i.selectedGame;i={teams:[],answeredQuestions:[],currentQuestion:null,selectedGame:e,currentTurn:0,lastPicker:0}}function W(){const e=`kuldvillak-game-state-${i.selectedGame}`,n=localStorage.getItem(e);if(n){const s=JSON.parse(n);if(s.teams&&s.teams.length>0){const t={teams:s.teams,answeredQuestions:[],currentQuestion:s.currentQuestion||null,selectedGame:s.selectedGame||y()[0],currentTurn:s.currentTurn??0,lastPicker:s.lastPicker??0};Array.isArray(s.answeredQuestions)&&s.answeredQuestions.length>0&&(typeof s.answeredQuestions[0]=="string"?t.answeredQuestions=s.answeredQuestions.map(o=>({questionId:o,answeredBy:null,isPositive:null})):t.answeredQuestions=s.answeredQuestions.map(o=>({questionId:o.questionId,answeredBy:o.answeredBy,isPositive:o.isPositive??(o.answeredBy!==null?!0:null)}))),i=t}}}function Y(){const e=[];return y().forEach(s=>{const t=`kuldvillak-game-state-${s}`,o=localStorage.getItem(t);if(o)try{const a=JSON.parse(o);a.teams.length>0&&e.push({gameId:s,state:a})}catch(a){console.error(`Error parsing saved game ${s}:`,a)}}),e}function Z(e){const n=`kuldvillak-game-state-${e}`;localStorage.removeItem(n),I()}function I(){const e=document.getElementById("saved-games-container");if(!e)return;const n=Y();if(n.length===0){e.innerHTML="",e.style.display="none";return}e.style.display="block",e.innerHTML='<h3 class="saved-games-title">Pooleliolevad m√§ngud</h3>',n.forEach(({gameId:s,state:t})=>{const o=document.createElement("div");o.className="saved-game-card";const l=y().indexOf(s)===0?"M√§ng 1":"M√§ng 2",d=`${t.answeredQuestions.length}/25`,L=t.teams.map(h=>`${h.name}: ${h.score}`).join(" | ");o.innerHTML=`
      <div class="saved-game-content" data-game-id="${s}">
        <div class="saved-game-header">
          <span class="saved-game-name">${l}</span>
          <span class="saved-game-progress">${d}</span>
        </div>
        <div class="saved-game-teams">${L}</div>
      </div>
      <button class="saved-game-delete" data-game-id="${s}" title="Kustuta salvestatud m√§ng">üóëÔ∏è</button>
    `,o.querySelector(".saved-game-content").addEventListener("click",()=>X(s)),o.querySelector(".saved-game-delete").addEventListener("click",h=>{h.stopPropagation(),confirm(`Kas oled kindel, et soovid kustutada m√§ngu "${l}"?`)&&Z(s)}),e.appendChild(o)})}async function X(e){const n=`kuldvillak-game-state-${e}`,s=localStorage.getItem(n);if(!s){alert("Salvestatud m√§ngu ei leitud!"),I();return}try{if(i=JSON.parse(s),!u[e]&&!await G(e))return;E(),g("game-screen")}catch(t){console.error("Error resuming game:",t),alert("Viga m√§ngu taasalustamisel!")}}function ee(){const e=[],n=[100,200,300,400,500];for(let s=0;s<5;s++)for(const t of n)e.push({category:s,value:t,question:"",answer:""});return e}function P(e=null){if(e){const n=T(e);n&&(c={gameId:e,title:n.data.title,categories:[...n.data.categories],questions:JSON.parse(JSON.stringify(n.data.questions)),isModified:!1})}else c={gameId:null,title:"",categories:["","","","",""],questions:ee(),isModified:!1};M(),g("editor-screen")}function M(){const e=document.getElementById("editor-game-title");e&&(e.value=c.title,e.addEventListener("input",()=>{c.title=e.value,c.isModified=!0}));const n=document.getElementById("category-inputs");n&&(n.innerHTML="",c.categories.forEach((s,t)=>{const o=document.createElement("input");o.type="text",o.className="category-input",o.placeholder=`Kategooria ${t+1}`,o.value=s,o.addEventListener("input",()=>{c.categories[t]=o.value,c.isModified=!0}),n.appendChild(o)})),A()}function A(){const e=document.getElementById("editor-board");if(!e)return;e.innerHTML="",[100,200,300,400,500].forEach(s=>{for(let t=0;t<5;t++){const o=c.questions.find(l=>l.category===t&&l.value===s),a=document.createElement("div");a.className="editor-cell";const r=o&&o.question.trim()!=="";r&&a.classList.add("filled"),a.innerHTML=`
        <span class="cell-value">${s}</span>
        <span class="cell-status">${r?"‚úì":"t√ºhi"}</span>
      `,a.addEventListener("click",()=>te(t,s)),e.appendChild(a)}})}function te(e,n){v={categoryIndex:e,value:n};const s=c.questions.find(r=>r.category===e&&r.value===n),t=document.getElementById("edit-question-text"),o=document.getElementById("edit-answer-text");t&&(t.value=s?.question||""),o&&(o.value=s?.answer||""),document.getElementById("question-editor-modal")?.classList.add("active")}function N(){document.getElementById("question-editor-modal")?.classList.remove("active"),v=null}function ne(){if(!v)return;const e=document.getElementById("edit-question-text"),n=document.getElementById("edit-answer-text"),s=c.questions.findIndex(t=>t.category===v.categoryIndex&&t.value===v.value);s!==-1&&(c.questions[s]={category:v.categoryIndex,value:v.value,question:e?.value||"",answer:n?.value||""},c.isModified=!0),N(),A()}function se(){c.isModified&&!confirm("Sul on salvestamata muudatusi. Kas oled kindel, et soovid lahkuda?")||(g("landing-screen"),B())}function oe(){document.getElementById("import-file-input")?.click()}function ae(e){const n=e.target,s=n.files?.[0];if(!s)return;const t=new FileReader;t.onload=o=>{try{const a=JSON.parse(o.target?.result);if(!a.categories||!Array.isArray(a.categories)||a.categories.length!==5)throw new Error("Invalid categories");if(!a.questions||!Array.isArray(a.questions))throw new Error("Invalid questions");c={gameId:null,title:a.title||"",categories:a.categories,questions:a.questions,isModified:!0},M(),alert("M√§ng imporditud edukalt!")}catch(a){console.error("Import error:",a),alert("Viga faili importimisel. Kontrolli, et fail on √µiges formaadis.")}},t.readAsText(s),n.value=""}function ie(){const n=document.getElementById("editor-game-title")?.value||c.title||"Minu m√§ng",s={title:n,categories:c.categories,questions:c.questions},t=JSON.stringify(s,null,2),o=new Blob([t],{type:"application/json"}),a=URL.createObjectURL(o),r=document.createElement("a");r.href=a,r.download=`${n.replace(/[^a-zA-Z0-9]/g,"_")}.json`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(a)}function re(){const e=document.getElementById("editor-game-title"),n=e?.value.trim();if(!n){alert("Palun sisesta m√§ngu pealkiri!"),e?.focus();return}if(c.categories.filter(r=>!r.trim()).length>0){alert("Palun t√§ida k√µik kategooriad!");return}if(c.questions.filter(r=>r.question.trim()!=="").length===0){alert("Palun lisa v√§hemalt √ºks k√ºsimus!");return}const o=c.gameId||`custom-${Date.now()}`,a={id:o,data:{title:n,categories:c.categories,questions:c.questions},createdAt:c.gameId&&T(o)?.createdAt||Date.now(),updatedAt:Date.now()};ce(a),c.gameId=o,c.isModified=!1,alert("M√§ng salvestatud!"),g("landing-screen"),B()}function le(){const e=[];for(let n=0;n<localStorage.length;n++){const s=localStorage.key(n);if(s?.startsWith("kuldvillak-custom-game-"))try{const t=JSON.parse(localStorage.getItem(s)||"");e.push(t)}catch(t){console.error("Error parsing custom game:",t)}}return e.sort((n,s)=>s.updatedAt-n.updatedAt)}function T(e){const n=`kuldvillak-custom-game-${e}`,s=localStorage.getItem(n);if(!s)return null;try{return JSON.parse(s)}catch{return null}}function ce(e){const n=`kuldvillak-custom-game-${e.id}`;localStorage.setItem(n,JSON.stringify(e)),u[e.id]=e.data}function de(e){const n=`kuldvillak-custom-game-${e}`;localStorage.removeItem(n),delete u[e];const s=`kuldvillak-game-state-${e}`;localStorage.removeItem(s)}function B(){const e=document.getElementById("custom-games-container");if(!e)return;const n=le();if(n.length===0){e.innerHTML="",e.style.display="none";return}e.style.display="block",e.innerHTML='<h3 class="custom-games-title">Minu m√§ngud</h3>';const s=document.createElement("div");s.className="custom-games-grid",n.forEach(t=>{const o=document.createElement("div");o.className="custom-game-card",o.innerHTML=`
      <div class="custom-game-name">${t.data.title}</div>
      <div class="custom-game-actions">
        <button class="btn-play" data-id="${t.id}">M√§ngi</button>
        <button class="btn-edit" data-id="${t.id}">Muuda</button>
        <button class="btn-delete" data-id="${t.id}">Kustuta</button>
      </div>
    `,o.querySelector(".btn-play")?.addEventListener("click",()=>{const a=T(t.id);a&&(u[t.id]=a.data,q(t.id))}),o.querySelector(".btn-edit")?.addEventListener("click",()=>{P(t.id)}),o.querySelector(".btn-delete")?.addEventListener("click",()=>{confirm(`Kas oled kindel, et soovid kustutada m√§ngu "${t.data.title}"?`)&&(de(t.id),B())}),s.appendChild(o)}),e.appendChild(s)}
